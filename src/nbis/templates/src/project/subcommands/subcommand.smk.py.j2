"""Run {{ subcommand }} snakemake workflow.

Some text.
"""
import logging
import os

import nbis.wrappers as wrappers
from {{ project_name }} import config
from nbis.snakemake import profile
from nbis.snakemake import add_arguments as add_snakemake_arguments

logger = logging.getLogger(__name__)


def add_arguments(parser):
{% if test %}
    add_snakemake_arguments(parser)
{% else %}
    add_snakemake_arguments(parser, test=False)
{% endif %}


def main(args):
    logger.info(f"Running {args.prog} {args.module_name}")
    snakefile = config.SNAKEMAKE_ROOT / "rules" / "{{ subcommand }}.smk"

    args.extra_options += [f"--jobs={args.jobs}"]

{% if test %}
    if args.test:
        args.extra_options += [
            "--config",
            "samples=resources/.test/samples.tsv",
            "__test__=True",
        ]
        args.no_profile = True
{% endif %}
    if args.profile:
        prof = profile(args.profile, config.config)
        if not args.no_profile:
            args.extra_options += ["--profile", prof]

    wrappers.snakemake(
        options=" ".join(args.extra_options), snakefile=snakefile, targets=""
    )

