"""{{ subcommand }} help.

This is an example help string.
"""
import logging
import os

import nbis.wrappers as wrappers
from {{ project_name }} import config
from nbis.snakemake import profile

logger = logging.getLogger(__name__)


def add_arguments(parser):
{% if test %}
    parser.add_argument(
        "--test",
        action="store_true",
        default=False,
        help="run workflow on small test data set",
    )
{% endif %}
    parser.add_argument(
        "--profile",
        action="store",
        default="local",
        help=(
            "snakemake profile, either defined as key:value pair in config"
            " or a URI pointing to profile directory"
        ),
    )
    parser.add_argument(
        "--no-profile",
        action="store_true",
        default=False,
        help="disable snakemake profile",
    )


def main(args):
    logger.info(f"Running {args.prog} {args.module_name}")
    snakefile = os.path.join(config.SNAKEMAKE_ROOT, "{{ subcommand }}.smk")

{% if test %}
    if args.test:
        args.extra_options += [
            "--config",
            "samples=resources/.test/samples.test.tsv",
            "__test__=True",
        ]
        args.no_profile = True
{% endif %}

    if args.profile:
        prof = profile(args.profile, config.config)
        if not args.no_profile:
            args.extra_options += ["--profile", prof]

    wrappers.snakemake(
        options=" ".join(args.extra_options), snakefile=snakefile, targets=""
    )
